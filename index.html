<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gen T. De Leon National High School Tracker</title>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --white: #fff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--secondary);
            color: var(--white);
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .logo span {
            color: var(--primary);
        }
        
        .card {
            background: var(--white);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .card-header h2 {
            font-size: 1.5rem;
            color: var(--secondary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            display: inline-block;
            padding: 12px 25px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-excel {
            background-color: #1d6f42;
            margin-top: 15px;
        }
        
        .user-role-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .role-option {
            flex: 1;
        }
        
        .role-option input[type="radio"] {
            display: none;
        }
        
        .role-option label {
            display: block;
            padding: 15px;
            background-color: var(--light);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .role-option input[type="radio"]:checked + label {
            background-color: var(--primary);
            color: var(--white);
        }
        
        .additional-fields {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .status-indicator {
            display: inline-block;
            margin-left: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-early {
            background-color: rgba(39, 174, 96, 0.2);
            color: var(--success);
        }
        
        .status-late {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--warning);
        }
        
        .status-ontime {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--primary);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        footer {
            background-color: var(--secondary);
            color: var(--white);
            text-align: center;
            padding: 20px 0;
            margin-top: 50px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .user-role-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">Gen T. De Leon National High School <span>Tracker</span></div>
            <p>Attendance Management System</p>
        </div>
    </header>
    
    <div class="container">
        <div class="attendance-form">
            <div class="card">
                <div class="card-header">
                    <h2>Attendance Registration</h2>
                </div>
                <form id="attendanceForm">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Select Your Role</label>
                        <div class="user-role-options">
                            <div class="role-option">
                                <input type="radio" id="student" name="userRole" value="student" checked>
                                <label for="student">Student</label>
                            </div>
                            <div class="role-option">
                                <input type="radio" id="teacher" name="userRole" value="teacher">
                                <label for="teacher">Teacher</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Student Fields -->
                    <div class="form-group student-fields">
                        <label for="studentId">Student ID</label>
                        <input type="text" id="studentId" class="form-control">
                    </div>
                    <div class="form-group student-fields">
                        <label for="gradeLevel">Grade Level</label>
                        <select id="gradeLevel" class="form-control">
                            <option value="">Select Grade</option>
                            <optgroup label="Morning Schedule (6:20AM-12:30NN)">
                                <option value="7">Grade 7</option>
                                <option value="10">Grade 10</option>
                                <option value="11">Grade 11</option>
                            </optgroup>
                            <optgroup label="Afternoon Schedule (12:45NN-7:30PM)">
                                <option value="8">Grade 8</option>
                                <option value="9">Grade 9</option>
                                <option value="12">Grade 12</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <!-- Teacher Fields -->
                    <div class="form-group teacher-fields additional-fields">
                        <label for="teacherId">Teacher ID</label>
                        <input type="text" id="teacherId" class="form-control">
                    </div>
                    <div class="form-group teacher-fields additional-fields">
                        <label for="department">Department</label>
                        <select id="department" class="form-control">
                            <option value="">Select Department</option>
                            <optgroup label="JHS Departments">
                                <option value="filipino">Filipino Department</option>
                                <option value="mapeh">MAPEH Department</option>
                                <option value="math">Mathematics Department</option>
                                <option value="esp">ESP Department</option>
                                <option value="ap">AP Department</option>
                                <option value="tle">TLE Department</option>
                                <option value="english">English Department</option>
                                <option value="science">Science Department</option>
                            </optgroup>
                            <optgroup label="Faculty For Building B">
                                <option value="faculty_a">Faculty A</option>
                                <option value="faculty_b">Faculty B</option>
                            </optgroup>
                            <optgroup label="Principal's Office Building A">
                                <option value="Principal's_office"> Principal's Office</option>
                            </optgroup>
                            <optgroup label="Assistant Principal's Office">
                                <option value="Assistant_principal's_office">Assistant Principal's Office</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="timeIn">Time In
                            <span id="timeInStatus" class="status-indicator" style="display: none;"></span>
                        </label>
                        <input type="time" id="timeIn" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="timeOut">Time Out</label>
                        <input type="time" id="timeOut" class="form-control">
                    </div>
                    
                    <button type="submit" class="btn btn-block">Submit Attendance</button>
                    
                    <div class="form-group" style="margin-top: 30px;">
                        <h3>Attendance Records</h3>
                        <div class="card">
                            <table id="recordsTable" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background-color: var(--secondary); color: white;">
                                        <th style="padding: 10px;">Name</th>
                                        <th style="padding: 10px;">Role</th>
                                        <th style="padding: 10px;">Time In</th>
                                        <th style="padding: 10px;">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recordsBody">
                                    <!-- Records will appear here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Gen T. De Leon National High School Tracker. All rights reserved.</p>
        </div>
    </footer>

    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    
    <script>
        // Your Firebase configuration (replace with your actual config)
       const firebaseConfig = {
  apiKey: "AIzaSyB...", // Hanapin sa Project Settings
  authDomain: "attendace-tracker-71475.firebaseapp.com",
  databaseURL: "https://attendace-tracker-71475-default-rtdb.firebaseio.com",
  projectId: "attendace-tracker-71475",
  storageBucket: "attendace-tracker-71475.appspot.com",
  messagingSenderId: "123456789", // Hanapin sa Project Settings
  appId: "1:123456789:web:abcdef..." // Hanapin sa Project Settings
};

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Database to store attendance records locally (for export functionality)
        let attendanceRecords = [];
        
        // Get current day (0 = Sunday, 1 = Monday, ..., 6 = Saturday)
        const today = new Date().getDay();
        const isFriday = today === 5;
        
        // Schedule configuration
        const gradeSchedules = {
            '7': { 
                start: '06:20', 
                end: '12:30', 
                label: '6:20AM-12:30NN',
                lateThreshold: 30 // minutes after start time to be considered late
            },
            '8': { 
                start: '12:45', 
                end: isFriday ? '18:45' : '19:30', 
                label: isFriday ? '12:45NN-6:45PM' : '12:45NN-7:30PM',
                lateThreshold: 15
            },
            '9': { 
                start: '12:45', 
                end: isFriday ? '18:45' : '19:30', 
                label: isFriday ? '12:45NN-6:45PM' : '12:45NN-7:30PM',
                lateThreshold: 15
            },
            '10': { 
                start: '06:20', 
                end: '12:30', 
                label: '6:20AM-12:30NN',
                lateThreshold: 30
            },
            '11': { 
                start: '06:20', 
                end: '12:30', 
                label: '6:20AM-12:30NN',
                lateThreshold: 30
            },
            '12': { 
                start: '12:45', 
                end: isFriday ? '18:45' : '19:30', 
                label: isFriday ? '12:45NN-6:45PM' : '12:45NN-7:30PM',
                lateThreshold: 15
            }
        };
        
        // Teacher schedule (8:00AM to 5:00PM)
        const teacherSchedule = {
            start: '08:00',
            end: '17:00',
            lateThreshold: 15
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get all radio buttons and additional fields
            const roleRadios = document.querySelectorAll('input[name="userRole"]');
            const studentFields = document.querySelectorAll('.student-fields');
            const teacherFields = document.querySelectorAll('.teacher-fields');
            const gradeSelect = document.getElementById('gradeLevel');
            const timeInField = document.getElementById('timeIn');
            const timeInStatus = document.getElementById('timeInStatus');
            
            // Initially show student fields and hide teacher fields
            teacherFields.forEach(field => field.style.display = 'none');
            
            // Load existing records from Firebase
            loadRecordsFromFirebase();
            
            // Add event listeners to radio buttons
            roleRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const selectedRole = this.value;
                    
                    // Hide all additional fields first
                    studentFields.forEach(field => field.style.display = 'none');
                    teacherFields.forEach(field => field.style.display = 'none');
                    
                    // Show fields based on selected role
                    if (selectedRole === 'student') {
                        studentFields.forEach(field => field.style.display = 'block');
                    } else if (selectedRole === 'teacher') {
                        teacherFields.forEach(field => field.style.display = 'block');
                    }
                    
                    // Update time in status when role changes
                    updateTimeInStatus();
                });
            });
            
            // Form submission
            document.getElementById('attendanceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form values
                const fullName = document.getElementById('fullName').value;
                const userRole = document.querySelector('input[name="userRole"]:checked').value;
                const timeIn = document.getElementById('timeIn').value;
                const timeOut = document.getElementById('timeOut').value;
                const gradeLevel = document.getElementById('gradeLevel').value;
                
                // Get role-specific information
                let id = '';
                let gradeDept = '';
                let status = 'On Time';
                
                if (userRole === 'student') {
                    id = document.getElementById('studentId').value;
                    gradeDept = 'Grade ' + gradeLevel;
                    
                    // Validate student time in against schedule
                    const schedule = gradeSchedules[gradeLevel];
                    if (schedule) {
                        const timeInHour = parseInt(timeIn.split(':')[0]);
                        const timeInMinute = parseInt(timeIn.split(':')[1]);
                        const scheduleStartHour = parseInt(schedule.start.split(':')[0]);
                        const scheduleStartMinute = parseInt(schedule.start.split(':')[1]);
                        
                        // Convert to minutes for comparison
                        const timeInTotal = timeInHour * 60 + timeInMinute;
                        const scheduleStartTotal = scheduleStartHour * 60 + scheduleStartMinute;
                        
                        // Special handling for afternoon session (12:45 PM)
                        if (scheduleStartHour >= 12) {
                            // For afternoon session, anything before 12:45 is early
                            if (timeInHour < 12 || (timeInHour === 12 && timeInMinute < 45)) {
                                status = 'Early';
                            } else if (timeInTotal > (scheduleStartTotal + schedule.lateThreshold)) {
                                status = 'Late';
                            } else {
                                status = 'On Time';
                            }
                        } else {
                            // Normal morning session handling
                            if (timeInTotal < scheduleStartTotal) {
                                status = 'Early';
                            } else if (timeInTotal > (scheduleStartTotal + schedule.lateThreshold)) {
                                status = 'Late';
                            } else {
                                status = 'On Time';
                            }
                        }
                    }
                } else if (userRole === 'teacher') {
                    id = document.getElementById('teacherId').value;
                    gradeDept = document.getElementById('department').value;
                    
                    // Check teacher against teacher schedule
                    const timeInHour = parseInt(timeIn.split(':')[0]);
                    const timeInMinute = parseInt(timeIn.split(':')[1]);
                    const scheduleStartHour = parseInt(teacherSchedule.start.split(':')[0]);
                    const scheduleStartMinute = parseInt(teacherSchedule.start.split(':')[1]);
                    
                    // Convert to minutes for comparison
                    const timeInTotal = timeInHour * 60 + timeInMinute;
                    const scheduleStartTotal = scheduleStartHour * 60 + scheduleStartMinute;
                    
                    if (timeInTotal < scheduleStartTotal) {
                        status = 'Early';
                    } else if (timeInTotal > (scheduleStartTotal + teacherSchedule.lateThreshold)) {
                        status = 'Late';
                    } else {
                        status = 'On Time';
                    }
                }
                
                // Simple validation
                if (!fullName || !timeIn) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Create record object
                const record = {
                    name: fullName,
                    role: userRole.charAt(0).toUpperCase() + userRole.slice(1),
                    id: id,
                    gradeDept: gradeDept,
                    timeIn: timeIn,
                    timeOut: timeOut || '',
                    status: status,
                    timestamp: new Date().toISOString()
                };
                
                // Add to local records array for export functionality
                attendanceRecords.push(record);
                
                // Save to Firebase
                saveRecordToFirebase(record);
                
                // Reset form
                this.reset();
                
                // Reset role fields visibility
                studentFields.forEach(field => field.style.display = 'block');
                teacherFields.forEach(field => field.style.display = 'none');
                document.getElementById('student').checked = true;
                
                alert(`Attendance recorded successfully!\nStatus: ${status}`);
            });
            
            // Update time in status when time changes
            timeInField.addEventListener('change', updateTimeInStatus);
            
            // Function to save record to Firebase
            function saveRecordToFirebase(record) {
                const newRecordRef = database.ref('attendance').push();
                newRecordRef.set(record)
                    .then(() => console.log("Record saved to Firebase"))
                    .catch(error => console.error("Error saving record:", error));
            }
            
            // Function to load records from Firebase
            function loadRecordsFromFirebase() {
                database.ref('attendance').on('value', (snapshot) => {
                    const recordsBody = document.getElementById('recordsBody');
                    recordsBody.innerHTML = '';
                    
                    snapshot.forEach((childSnapshot) => {
                        const record = childSnapshot.val();
                        const row = document.createElement('tr');
                        row.style.borderBottom = '1px solid #ddd';
                        row.innerHTML = `
                            <td style="padding: 10px;">${record.name}</td>
                            <td style="padding: 10px;">${record.role}</td>
                            <td style="padding: 10px;">${formatTime(record.timeIn)}</td>
                            <td style="padding: 10px;"><span class="status-indicator ${getStatusClass(record.status)}">${record.status}</span></td>
                        `;
                        recordsBody.appendChild(row);
                    });
                });
            }
            
            // Helper function to get status class
            function getStatusClass(status) {
                switch(status) {
                    case 'Early': return 'status-early';
                    case 'Late': return 'status-late';
                    default: return 'status-ontime';
                }
            }
            
            // Function to update time in status indicator
            function updateTimeInStatus() {
                const timeIn = timeInField.value;
                if (!timeIn) {
                    timeInStatus.style.display = 'none';
                    return;
                }
                
                const userRole = document.querySelector('input[name="userRole"]:checked').value;
                const gradeLevel = document.getElementById('gradeLevel').value;
                
                let schedule, statusText, statusClass;
                
                if (userRole === 'student' && gradeLevel) {
                    schedule = gradeSchedules[gradeLevel];
                    if (!schedule) {
                        timeInStatus.style.display = 'none';
                        return;
                    }
                    
                    const timeInHour = parseInt(timeIn.split(':')[0]);
                    const timeInMinute = parseInt(timeIn.split(':')[1]);
                    const scheduleStartHour = parseInt(schedule.start.split(':')[0]);
                    const scheduleStartMinute = parseInt(schedule.start.split(':')[1]);
                    
                    // Convert to minutes for comparison
                    const timeInTotal = timeInHour * 60 + timeInMinute;
                    const scheduleStartTotal = scheduleStartHour * 60 + scheduleStartMinute;
                    
                    // Special handling for afternoon session (12:45 PM)
                    if (scheduleStartHour >= 12) {
                        // For afternoon session, anything before 12:45 is early
                        if (timeInHour < 12 || (timeInHour === 12 && timeInMinute < 45)) {
                            statusText = 'Early';
                            statusClass = 'status-early';
                        } else if (timeInTotal > (scheduleStartTotal + schedule.lateThreshold)) {
                            statusText = 'Late';
                            statusClass = 'status-late';
                        } else {
                            statusText = 'On Time';
                            statusClass = 'status-ontime';
                        }
                    } else {
                        // Normal morning session handling
                        if (timeInTotal < scheduleStartTotal) {
                            statusText = 'Early';
                            statusClass = 'status-early';
                        } else if (timeInTotal > (scheduleStartTotal + schedule.lateThreshold)) {
                            statusText = 'Late';
                            statusClass = 'status-late';
                        } else {
                            statusText = 'On Time';
                            statusClass = 'status-ontime';
                        }
                    }
                } else if (userRole === 'teacher') {
                    schedule = teacherSchedule;
                    
                    const timeInHour = parseInt(timeIn.split(':')[0]);
                    const timeInMinute = parseInt(timeIn.split(':')[1]);
                    const scheduleStartHour = parseInt(schedule.start.split(':')[0]);
                    const scheduleStartMinute = parseInt(schedule.start.split(':')[1]);
                    
                    // Convert to minutes for comparison
                    const timeInTotal = timeInHour * 60 + timeInMinute;
                    const scheduleStartTotal = scheduleStartHour * 60 + scheduleStartMinute;
                    
                    if (timeInTotal < scheduleStartTotal) {
                        statusText = 'Early';
                        statusClass = 'status-early';
                    } else if (timeInTotal > (scheduleStartTotal + schedule.lateThreshold)) {
                        statusText = 'Late';
                        statusClass = 'status-late';
                    } else {
                        statusText = 'On Time';
                        statusClass = 'status-ontime';
                    }
                } else {
                    timeInStatus.style.display = 'none';
                    return;
                }
                
                timeInStatus.textContent = statusText;
                timeInStatus.className = `status-indicator ${statusClass}`;
                timeInStatus.style.display = 'inline-block';
            }
            
            // Set current time for time in/out fields
            function setCurrentTime(fieldId) {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                
                // For time-in, set appropriate demo time based on grade level
                if (fieldId === 'timeIn') {
                    const gradeLevel = document.getElementById('gradeLevel').value;
                    const userRole = document.querySelector('input[name="userRole"]:checked').value;
                    
                    let schedule;
                    if (userRole === 'student' && gradeLevel) {
                        schedule = gradeSchedules[gradeLevel];
                    } else if (userRole === 'teacher') {
                        schedule = teacherSchedule;
                    }
                    
                    if (schedule) {
                        // Set demo time to 15 minutes after schedule start
                        const [startHour, startMinute] = schedule.start.split(':');
                        let demoHour = parseInt(startHour);
                        let demoMinute = parseInt(startMinute) + 15;
                        
                        if (demoMinute >= 60) {
                            demoHour += 1;
                            demoMinute -= 60;
                        }
                        
                        document.getElementById(fieldId).value = 
                            `${demoHour.toString().padStart(2, '0')}:${demoMinute.toString().padStart(2, '0')}`;
                        updateTimeInStatus();
                        return;
                    }
                }
                
                // Default to current time
                document.getElementById(fieldId).value = `${hours}:${minutes}`;
                updateTimeInStatus();
            }
            
            // Add click event to set current time
            document.getElementById('timeIn').addEventListener('focus', function() {
                setCurrentTime('timeIn');
            });
            
            document.getElementById('timeOut').addEventListener('focus', function() {
                setCurrentTime('timeOut');
            });
            
            // Show schedule when grade level is selected
            gradeSelect.addEventListener('change', function() {
                const grade = this.value;
                const schedule = gradeSchedules[grade];
                
                if (schedule) {
                    // Update time-in placeholder to show expected schedule
                    document.getElementById('timeIn').placeholder = `Schedule: ${schedule.label}`;
                }
                updateTimeInStatus();
            });
            
            // Format time for display (24h to 12h)
            function formatTime(timeString) {
                if (!timeString) return '';
                
                const [hours, minutes] = timeString.split(':');
                const hourNum = parseInt(hours);
                const ampm = hourNum >= 12 ? 'PM' : 'AM';
                const hour12 = hourNum % 12 || 12;
                
                return `${hour12}:${minutes} ${ampm}`;
            }
        });
    </script>
</body>
</html>